- name: Provision API
  hosts: api
  remote_user: "{{ remote_user }}"

  vars:
    temp_dir: "/tmp"
    logging_dir: "/var/log/openconext"
    releases_dir: "/opt/openconext"
    builds_dir: "{{ releases_dir }}/builds"
    configs_dir: "/etc/openconext"

    # API specific variables
    api_git_url: "https://github.com/OpenConext/OpenConext-api.git"
    api_version_dir: "{{ api_version | replace('/', '-') }}"
    api_release_dir: "{{ releases_dir }}/OpenConext-api-{{ api_version_dir }}"
    api_build_path: "{{ builds_dir }}/coin-api-dist-{{ api_version }}-bin.tar.gz"
    api_download_url: "https://build.surfconext.nl/repository/public/releases/org/surfnet/coin/coin-api-dist/{{ api_version }}/coin-api-dist-{{ api_version }}-bin.tar.gz"
    api_tomcat_path: "/usr/share/tomcat6"
    api_tomcat_wars_path: "{{ api_tomcat_path }}/wars"
    api_tomcat_work_path: "{{ api_tomcat_path }}/work/Catalina/api.{{ openconext_domain }}"
    api_tomcat_webapps_path: "{{ api_tomcat_path }}/webapps/api.{{ openconext_domain }}"


  pre_tasks:
    - name: Provision DB & DB user

  roles:
    - { role: openconext-api }

  post_tasks:
    - name: Provision Apache proxy